{"version":3,"file":"event.js","sourceRoot":"","sources":["../src/event.ts"],"names":[],"mappings":"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","sourcesContent":["import { Context } from './common';\nimport { ResponseContextErr } from './fetch';\nimport { HyPushState } from \"./index\";\n\nconst timeout = (t: number) => new Promise(r => setTimeout(r, t));\n\nexport class EventManager {\n  private parent: HyPushState;\n\n  constructor(parent: HyPushState) {\n    this.parent = parent;\n  }\n\n  onStart(context: Context) {\n    this.parent.animPromise = timeout(this.parent.duration);\n\n    const transitionUntil = (promise: Promise<{}>) => {\n      this.parent.animPromise = Promise.all([this.parent.animPromise, promise]);\n    };\n\n    this.parent.fireEvent('start', { detail: { ...context, transitionUntil } });\n  }\n\n  emitDOMError(error: any) {\n    if (process.env.DEBUG) console.error(error);\n\n    // To open the link directly, we first pop one entry off the browser history.\n    // We have to do this because some browsers (Safari) won't handle the back button correctly otherwise.\n    // We then wait for a short time and change the document's location.\n    // TODO: If we didn't call `pushState` optimistically we wouldn't have to do this.\n    // TODO: Use browser sniffing instead?\n    const url = location.href;\n    window.history.back();\n    setTimeout(() => document.location.assign(url), 100);\n  }\n\n  emitNetworkError(context: ResponseContextErr) {\n    if (process.env.DEBUG) console.error(context);\n    this.parent.fireEvent('networkerror', { detail: context });\n  }\n\n  emitError(context: Context) {\n    if (process.env.DEBUG) console.error(context);\n    this.parent.fireEvent('error', { detail: context });\n  }\n\n  emitReady(context: Context) {\n    this.parent.fireEvent('ready', { detail: context });\n  }\n\n  emitAfter(context: Context) {\n    this.parent.fadePromise = timeout(this.parent.duration);\n\n    const transitionUntil = (promise: Promise<{}>) => {\n      this.parent.fadePromise = Promise.all([this.parent.fadePromise, promise]);\n    };\n\n    this.parent.fireEvent('after', { detail: { ...context, transitionUntil } });\n  }\n\n  emitProgress(context: Context) {\n    this.parent.fireEvent('progress', { detail: context });\n  }\n\n  emitLoad(context: Context) {\n    this.parent.fireEvent('load', { detail: context });\n  }\n};"]}